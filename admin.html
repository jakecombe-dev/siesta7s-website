<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Siesta 7s</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --navy: #1a365d;
      --sunset: #f6893a;
      --teal: #2d8b9e;
      --gold: #f4c542;
      --sand: #f5f0e6;
      --white: #ffffff;
      --gray-100: #f7fafc;
      --gray-200: #edf2f7;
      --gray-300: #e2e8f0;
      --gray-600: #718096;
      --gray-800: #2d3748;
      --success: #48bb78;
      --danger: #f56565;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--gray-100);
      min-height: 100vh;
    }

    /* Login Screen */
    .login-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--navy) 0%, var(--teal) 100%);
    }

    .login-card {
      background: var(--white);
      padding: 3rem;
      border-radius: 16px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      width: 100%;
      max-width: 400px;
      text-align: center;
    }

    .login-card h1 {
      color: var(--navy);
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .login-card p {
      color: var(--gray-600);
      margin-bottom: 2rem;
    }

    .login-input {
      width: 100%;
      padding: 1rem;
      border: 2px solid var(--gray-200);
      border-radius: 8px;
      font-size: 1rem;
      margin-bottom: 1rem;
      transition: border-color 0.2s;
    }

    .login-input:focus {
      outline: none;
      border-color: var(--teal);
    }

    .login-btn {
      width: 100%;
      padding: 1rem;
      background: var(--sunset);
      color: var(--white);
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(246, 137, 58, 0.4);
    }

    .login-error {
      color: var(--danger);
      font-size: 0.875rem;
      margin-top: 1rem;
      display: none;
    }

    /* Dashboard */
    .dashboard {
      display: none;
    }

    .dashboard.active {
      display: block;
    }

    .dashboard-header {
      background: var(--navy);
      color: var(--white);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .dashboard-header h1 {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .logout-btn {
      background: rgba(255,255,255,0.1);
      color: var(--white);
      border: 1px solid rgba(255,255,255,0.2);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: background 0.2s;
    }

    .logout-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    .dashboard-nav {
      background: var(--white);
      border-bottom: 1px solid var(--gray-200);
      padding: 0 2rem;
      display: flex;
      gap: 0;
    }

    .nav-tab {
      padding: 1rem 1.5rem;
      border: none;
      background: none;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray-600);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .nav-tab:hover {
      color: var(--navy);
    }

    .nav-tab.active {
      color: var(--teal);
      border-bottom-color: var(--teal);
    }

    .dashboard-content {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--white);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .stat-card.clickable {
      cursor: pointer;
    }

    .stat-card.clickable:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .stat-card h3 {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--gray-600);
      margin-bottom: 0.5rem;
    }

    .stat-card .value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--navy);
    }

    .stat-card .subtext {
      font-size: 0.875rem;
      color: var(--gray-600);
    }

    /* Data Table */
    .table-card {
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .table-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .table-header h2 {
      font-size: 1rem;
      color: var(--navy);
    }

    .refresh-btn {
      background: var(--gray-100);
      border: 1px solid var(--gray-300);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.875rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .refresh-btn:hover {
      background: var(--gray-200);
    }

    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--gray-200);
      font-size: 0.875rem;
    }

    th {
      background: var(--gray-50);
      font-weight: 600;
      color: var(--gray-600);
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.05em;
    }

    tr:hover {
      background: var(--gray-50);
    }

    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .status-paid {
      background: #c6f6d5;
      color: #22543d;
    }

    .status-pending {
      background: #feebc8;
      color: #744210;
    }

    .action-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.25rem;
      color: var(--gray-600);
      transition: color 0.2s;
    }

    .action-btn:hover {
      color: var(--teal);
    }

    .action-btn.delete:hover {
      color: var(--danger);
    }

    /* Loading State */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      color: var(--gray-600);
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--gray-300);
      border-top-color: var(--teal);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 0.5rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Tab panels */
    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--gray-600);
    }

    .empty-state svg {
      width: 48px;
      height: 48px;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--white);
      border-radius: 12px;
      width: 100%;
      max-width: 650px;
      max-height: 85vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-size: 1.125rem;
      color: var(--navy);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray-600);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray-800);
      margin-bottom: 0.5rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--gray-300);
      border-radius: 6px;
      font-size: 0.875rem;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .form-group textarea {
      resize: none;
      overflow: hidden;
      min-height: 100px;
      line-height: 1.5;
    }

    .modal-footer {
      padding: 1.5rem;
      border-top: 1px solid var(--gray-200);
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-secondary {
      background: var(--gray-100);
      border: 1px solid var(--gray-300);
      color: var(--gray-800);
    }

    .btn-primary {
      background: var(--teal);
      border: none;
      color: var(--white);
    }

    .btn-primary:hover {
      background: #247a8a;
    }

    .btn-danger {
      background: var(--danger);
      border: none;
      color: var(--white);
    }

    /* Revenue highlight */
    .revenue {
      color: var(--success);
    }

    @media (max-width: 768px) {
      .dashboard-nav {
        overflow-x: auto;
        padding: 0 1rem;
      }

      .dashboard-content {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>

  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <div class="login-card">
      <h1>üèâ Siesta 7s Admin</h1>
      <p>Enter password to access dashboard</p>
      <form id="loginForm">
        <input type="password" class="login-input" id="passwordInput" placeholder="Password" autocomplete="off">
        <button type="submit" class="login-btn">Login</button>
        <p class="login-error" id="loginError">Incorrect password. Try again.</p>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">
    <header class="dashboard-header">
      <h1>üèâ Siesta 7s ‚Äî Event Dashboard</h1>
      <button class="logout-btn" id="logoutBtn">Logout</button>
    </header>

    <nav class="dashboard-nav">
      <button class="nav-tab active" data-tab="overview">Overview</button>
      <button class="nav-tab" data-tab="teams">Teams</button>
      <button class="nav-tab" data-tab="freeagents">Free Agents</button>
      <button class="nav-tab" data-tab="vendors">Vendors</button>
      <button class="nav-tab" data-tab="sponsors">Sponsors</button>
      <button class="nav-tab" data-tab="schedule">Schedule</button>
      <button class="nav-tab" data-tab="pricing">Pricing</button>
    </nav>

    <main class="dashboard-content">
      <!-- Overview Tab -->
      <div class="tab-panel active" id="overview">
        <div class="stats-grid">
          <div class="stat-card clickable" data-navigate="teams">
            <h3>Teams Registered</h3>
            <div class="value" id="teamCount">-</div>
          </div>
          <div class="stat-card clickable" data-navigate="freeagents">
            <h3>Free Agents</h3>
            <div class="value" id="freeAgentCount">-</div>
          </div>
          <div class="stat-card clickable" data-navigate="vendors">
            <h3>Vendors</h3>
            <div class="value" id="vendorCount">-</div>
          </div>
          <div class="stat-card clickable" data-navigate="sponsors">
            <h3>Sponsors</h3>
            <div class="value" id="sponsorCount">-</div>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <h3>Total Revenue (Expected)</h3>
            <div class="value revenue" id="totalRevenue">$0</div>
            <div class="subtext">Based on registration fees</div>
          </div>
          <div class="stat-card">
            <h3>Days Until Event</h3>
            <div class="value" id="daysUntil">-</div>
            <div class="subtext">May 16, 2025</div>
          </div>
        </div>
      </div>

      <!-- Teams Tab -->
      <div class="tab-panel" id="teams">
        <div class="table-card">
          <div class="table-header">
            <h2>Team Registrations</h2>
            <button class="refresh-btn" onclick="loadData('Teams')">
              <span>‚Üª</span> Refresh
            </button>
          </div>
          <div class="table-container">
            <div class="loading" id="teamsLoading">
              <div class="spinner"></div>
              Loading...
            </div>
            <table id="teamsTable" style="display:none;">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Team Name</th>
                  <th>Captain</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Division</th>
                  <th>Amount</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="teamsBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Free Agents Tab -->
      <div class="tab-panel" id="freeagents">
        <div class="table-card">
          <div class="table-header">
            <h2>Free Agent Registrations</h2>
            <button class="refresh-btn" onclick="loadData('Free Agents')">
              <span>‚Üª</span> Refresh
            </button>
          </div>
          <div class="table-container">
            <div class="loading" id="freeagentsLoading">
              <div class="spinner"></div>
              Loading...
            </div>
            <table id="freeagentsTable" style="display:none;">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Experience</th>
                  <th>Amount</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="freeagentsBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Vendors Tab -->
      <div class="tab-panel" id="vendors">
        <div class="table-card">
          <div class="table-header">
            <h2>Vendor Applications</h2>
            <button class="refresh-btn" onclick="loadData('Vendors')">
              <span>‚Üª</span> Refresh
            </button>
          </div>
          <div class="table-container">
            <div class="loading" id="vendorsLoading">
              <div class="spinner"></div>
              Loading...
            </div>
            <table id="vendorsTable" style="display:none;">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Business</th>
                  <th>Contact</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Type</th>
                  <th>Amount</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="vendorsBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Sponsors Tab -->
      <div class="tab-panel" id="sponsors">
        <div class="table-card">
          <div class="table-header">
            <h2>Sponsor Inquiries</h2>
            <button class="refresh-btn" onclick="loadData('Sponsors')">
              <span>‚Üª</span> Refresh
            </button>
          </div>
          <div class="table-container">
            <div class="loading" id="sponsorsLoading">
              <div class="spinner"></div>
              Loading...
            </div>
            <table id="sponsorsTable" style="display:none;">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Company</th>
                  <th>Contact</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Level</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="sponsorsBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Schedule Tab -->
      <div class="tab-panel" id="schedule">
        <div class="table-card">
          <div class="table-header">
            <h2>Weekend Schedule</h2>
            <button class="btn btn-primary" onclick="openScheduleModal()">+ Add Event</button>
          </div>
          <div class="table-container">
            <table id="scheduleTable">
              <thead>
                <tr>
                  <th>Day</th>
                  <th>Date</th>
                  <th>Event</th>
                  <th>Time</th>
                  <th>Location</th>
                  <th>Description</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="scheduleBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Pricing Tab -->
      <div class="tab-panel" id="pricing">
        <div class="table-card" style="margin-bottom: 2rem;">
          <div class="table-header">
            <h2>Team Registration Pricing</h2>
            <button class="btn btn-primary" onclick="openPricingModal('team')">+ Add Tier</button>
          </div>
          <div class="table-container">
            <table id="teamPricingTable">
              <thead>
                <tr>
                  <th>Tier Name</th>
                  <th>Price</th>
                  <th>Deadline</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="teamPricingBody"></tbody>
            </table>
          </div>
        </div>

        <div class="table-card">
          <div class="table-header">
            <h2>Free Agent Pricing</h2>
            <button class="btn btn-primary" onclick="openPricingModal('freeagent')">+ Add Tier</button>
          </div>
          <div class="table-container">
            <table id="freeagentPricingTable">
              <thead>
                <tr>
                  <th>Tier Name</th>
                  <th>Price</th>
                  <th>Deadline</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="freeagentPricingBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Edit Modal -->
  <div class="modal-overlay" id="editModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Edit Entry</h3>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="editModalBody">
        <!-- Dynamic form fields -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveEdit()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Confirm Delete</h3>
        <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this entry? This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
        <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>

  <!-- Schedule Modal -->
  <div class="modal-overlay" id="scheduleModal">
    <div class="modal">
      <div class="modal-header">
        <h3 id="scheduleModalTitle">Add Event</h3>
        <button class="modal-close" onclick="closeScheduleModal()">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="scheduleEditIndex" value="-1">
        <div class="form-group">
          <label>Day *</label>
          <select id="scheduleDay" required>
            <option value="Friday">Friday</option>
            <option value="Saturday">Saturday</option>
            <option value="Sunday">Sunday</option>
          </select>
        </div>
        <div class="form-group">
          <label>Date Label *</label>
          <input type="text" id="scheduleDate" placeholder="e.g., May 15, 2025 or Evening" required>
        </div>
        <div class="form-group">
          <label>Event Title *</label>
          <input type="text" id="scheduleTitle" placeholder="e.g., Pre-Tournament Party" required>
        </div>
        <div class="form-group">
          <label>Time *</label>
          <input type="text" id="scheduleTime" placeholder="e.g., 6:00 PM - 9:00 PM" required>
        </div>
        <div class="form-group">
          <label>Location *</label>
          <input type="text" id="scheduleLocation" placeholder="e.g., Siesta Key Beach" required>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="scheduleDescription" rows="3" placeholder="Event description..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeScheduleModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveScheduleEvent()">Save Event</button>
      </div>
    </div>
  </div>

  <!-- Pricing Modal -->
  <div class="modal-overlay" id="pricingModal">
    <div class="modal">
      <div class="modal-header">
        <h3 id="pricingModalTitle">Add Pricing Tier</h3>
        <button class="modal-close" onclick="closePricingModal()">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="pricingEditIndex" value="-1">
        <input type="hidden" id="pricingType" value="team">
        <div class="form-group">
          <label>Tier Name *</label>
          <input type="text" id="pricingTierName" placeholder="e.g., Super Early" required>
        </div>
        <div class="form-group">
          <label>Price *</label>
          <input type="text" id="pricingPrice" placeholder="e.g., $200" required>
        </div>
        <div class="form-group">
          <label>Deadline *</label>
          <input type="text" id="pricingDeadline" placeholder="e.g., February 28, 2025" required>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closePricingModal()">Cancel</button>
        <button class="btn btn-primary" onclick="savePricingTier()">Save Tier</button>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const CONFIG = {
      password: 'Surge2010!',
      scriptUrl: 'https://script.google.com/macros/s/AKfycbyndwQKFl7FMY9PjM525VMR8ImmhMm5ShelQtGU1wcVnZtxCyERMfxQohDzeo8wdgmkpA/exec',
      eventDate: new Date('2025-05-16T09:00:00-04:00')
    };

    // State
    let allData = {
      'Teams': [],
      'Free Agents': [],
      'Vendors': [],
      'Sponsors': []
    };
    let currentEdit = null;
    let currentDelete = null;

    // DOM Elements
    const loginScreen = document.getElementById('loginScreen');
    const dashboard = document.getElementById('dashboard');
    const loginForm = document.getElementById('loginForm');
    const loginError = document.getElementById('loginError');
    const passwordInput = document.getElementById('passwordInput');

    // Check if already logged in
    if (sessionStorage.getItem('siesta7s_admin') === 'true') {
      showDashboard();
    }

    // Login handling
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (passwordInput.value === CONFIG.password) {
        sessionStorage.setItem('siesta7s_admin', 'true');
        showDashboard();
      } else {
        loginError.style.display = 'block';
        passwordInput.value = '';
      }
    });

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', () => {
      sessionStorage.removeItem('siesta7s_admin');
      location.reload();
    });

    // Tab navigation
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.dataset.tab;
        
        // Update active tab
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update active panel
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        
        // Load data for this tab
        if (tabId !== 'overview') {
          const formType = tabId === 'freeagents' ? 'Free Agents' : 
                          tabId.charAt(0).toUpperCase() + tabId.slice(1);
          loadData(formType);
        }
      });
    });

    // Clickable stat cards on overview - navigate to corresponding tab
    document.querySelectorAll('.stat-card.clickable').forEach(card => {
      card.addEventListener('click', () => {
        const tabId = card.dataset.navigate;
        if (!tabId) return;
        
        // Find the corresponding nav tab and click it
        const navTab = document.querySelector(`.nav-tab[data-tab="${tabId}"]`);
        if (navTab) {
          navTab.click();
        }
      });
    });

    function showDashboard() {
      loginScreen.style.display = 'none';
      dashboard.classList.add('active');
      loadAllData();
    }

    async function loadAllData() {
      updateDaysUntil();
      
      // Load all data types
      await Promise.all([
        loadData('Teams'),
        loadData('Free Agents'),
        loadData('Vendors'),
        loadData('Sponsors')
      ]);
      
      updateOverviewStats();
    }

    async function loadData(formType) {
      const tabId = formType === 'Free Agents' ? 'freeagents' : formType.toLowerCase();
      const loading = document.getElementById(`${tabId}Loading`);
      const table = document.getElementById(`${tabId}Table`);
      const tbody = document.getElementById(`${tabId}Body`);
      
      if (loading) loading.style.display = 'flex';
      if (table) table.style.display = 'none';
      
      try {
        const response = await fetch(`${CONFIG.scriptUrl}?action=getData&formType=${encodeURIComponent(formType)}`);
        const result = await response.json();
        
        if (result.data) {
          allData[formType] = result.data;
          renderTable(formType, result.data);
        }
      } catch (error) {
        console.error(`Error loading ${formType}:`, error);
        if (tbody) {
          tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;padding:2rem;color:var(--gray-600);">
            Error loading data. Make sure Google Sheets is configured correctly.
          </td></tr>`;
        }
      }
      
      if (loading) loading.style.display = 'none';
      if (table) table.style.display = 'table';
    }

    function renderTable(formType, data) {
      const tabId = formType === 'Free Agents' ? 'freeagents' : formType.toLowerCase();
      const tbody = document.getElementById(`${tabId}Body`);
      
      if (!tbody) return;
      
      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;padding:2rem;color:var(--gray-600);">
          No registrations yet.
        </td></tr>`;
        return;
      }
      
      tbody.innerHTML = data.map((row, index) => {
        const date = row[0] ? new Date(row[0]).toLocaleDateString() : '-';
        return `
          <tr>
            <td>${date}</td>
            ${row.slice(1).map(cell => `<td>${cell || '-'}</td>`).join('')}
            <td>
              <button class="action-btn" onclick="editRow('${formType}', ${index})" title="Edit">‚úèÔ∏è</button>
              <button class="action-btn delete" onclick="deleteRow('${formType}', ${index})" title="Delete">üóëÔ∏è</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function updateOverviewStats() {
      document.getElementById('teamCount').textContent = allData['Teams'].length;
      document.getElementById('freeAgentCount').textContent = allData['Free Agents'].length;
      document.getElementById('vendorCount').textContent = allData['Vendors'].length;
      document.getElementById('sponsorCount').textContent = allData['Sponsors'].length;
      
      // Calculate total revenue (simplified - you may want to sum actual amounts)
      let revenue = 0;
      allData['Teams'].forEach(row => {
        const amount = parseFloat(row[row.length - 1]) || 0;
        revenue += amount;
      });
      allData['Free Agents'].forEach(row => {
        const amount = parseFloat(row[row.length - 1]) || 0;
        revenue += amount;
      });
      allData['Vendors'].forEach(row => {
        const amount = parseFloat(row[row.length - 1]) || 0;
        revenue += amount;
      });
      
      document.getElementById('totalRevenue').textContent = `$${revenue.toLocaleString()}`;
    }

    function updateDaysUntil() {
      const now = new Date();
      const diff = CONFIG.eventDate - now;
      const days = Math.max(0, Math.floor(diff / (1000 * 60 * 60 * 24)));
      document.getElementById('daysUntil').textContent = days;
    }

    function editRow(formType, index) {
      currentEdit = { formType, index };
      const row = allData[formType][index];
      
      const modalBody = document.getElementById('editModalBody');
      const headers = getHeaders(formType);
      
      modalBody.innerHTML = headers.map((header, i) => `
        <div class="form-group">
          <label>${header}</label>
          <input type="text" id="editField${i}" value="${row[i] || ''}">
        </div>
      `).join('');
      
      document.getElementById('editModal').classList.add('active');
    }

    function getHeaders(formType) {
      switch (formType) {
        case 'Teams':
          return ['Date', 'Team Name', 'Captain', 'Email', 'Phone', 'Division', 'Tier', 'Amount'];
        case 'Free Agents':
          return ['Date', 'Name', 'Email', 'Phone', 'Experience', 'Tier', 'Amount'];
        case 'Vendors':
          return ['Date', 'Business', 'Contact', 'Email', 'Phone', 'Type', 'Tier', 'Amount'];
        case 'Sponsors':
          return ['Date', 'Company', 'Contact', 'Email', 'Phone', 'Level', 'Message'];
        default:
          return [];
      }
    }

    async function saveEdit() {
      if (!currentEdit) return;
      
      const { formType, index } = currentEdit;
      const headers = getHeaders(formType);
      const newData = headers.map((_, i) => document.getElementById(`editField${i}`).value);
      
      try {
        const response = await fetch(CONFIG.scriptUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'updateRow',
            formType,
            rowIndex: index + 2, // +2 because sheets are 1-indexed and have header row
            data: newData
          })
        });
        
        // Update local data
        allData[formType][index] = newData;
        renderTable(formType, allData[formType]);
        updateOverviewStats();
        closeModal();
        
        alert('Changes saved successfully!');
      } catch (error) {
        console.error('Error saving:', error);
        alert('Error saving changes. Please try again.');
      }
    }

    function closeModal() {
      document.getElementById('editModal').classList.remove('active');
      currentEdit = null;
    }

    function deleteRow(formType, index) {
      currentDelete = { formType, index };
      document.getElementById('deleteModal').classList.add('active');
    }

    async function confirmDelete() {
      if (!currentDelete) return;
      
      const { formType, index } = currentDelete;
      
      try {
        const response = await fetch(CONFIG.scriptUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'deleteRow',
            formType,
            rowIndex: index + 2 // +2 because sheets are 1-indexed and have header row
          })
        });
        
        // Update local data
        allData[formType].splice(index, 1);
        renderTable(formType, allData[formType]);
        updateOverviewStats();
        closeDeleteModal();
        
        alert('Entry deleted successfully!');
      } catch (error) {
        console.error('Error deleting:', error);
        alert('Error deleting entry. Please try again.');
      }
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('active');
      currentDelete = null;
    }

    // =====================================================
    // SCHEDULE MANAGEMENT
    // =====================================================
    
    const DEFAULT_SCHEDULE = [
      {
        day: 'Friday',
        date: 'May 15, 2025',
        title: 'Pre-Tournament Party',
        time: '6:00 PM - 9:00 PM',
        location: 'Daiquiri Deck Southbridge',
        description: 'Kick off the weekend right! Meet other teams, enjoy live music, enter the 50/50 raffle, compete in the cornhole tournament, and grab some giveaways. The perfect warm-up for tournament day.'
      },
      {
        day: 'Saturday',
        date: 'May 16, 2025',
        title: 'Tournament Day',
        time: 'Kickoff at 9:00 AM',
        location: 'Siesta Key Beach',
        description: 'The main event! Beach rugby matches throughout the day on the famous white quartz sand. Food vendors, merchandise, music, and incredible beach atmosphere. Awards ceremony following the final matches.'
      },
      {
        day: 'Saturday',
        date: 'Evening',
        title: 'Siesta Stumble Bar Crawl',
        time: 'After Tournament Concludes',
        location: 'Siesta Key Village',
        description: 'Keep the celebration going! Post-tournament bar crawl hitting multiple iconic Siesta Key Village spots. All venues within walking distance ‚Äî no driving needed. The perfect way to cap off an epic day.'
      }
    ];

    const DEFAULT_TEAM_PRICING = [
      { name: 'Super Early', price: '$200', deadline: 'February 28, 2025' },
      { name: 'Early Bird', price: '$250', deadline: 'March 31, 2025' },
      { name: 'Regular', price: '$300', deadline: 'April 30, 2025' },
      { name: 'Late', price: '$350', deadline: 'May 15, 2025' }
    ];

    const DEFAULT_FREEAGENT_PRICING = [
      { name: 'Earliest Rate', price: '$30', deadline: 'March 15, 2025' },
      { name: 'Normal Rate', price: '$40', deadline: 'May 9, 2025' },
      { name: 'Final Week Rate', price: '$50', deadline: 'May 15, 2025' }
    ];

    function getScheduleData() {
      const stored = localStorage.getItem('siesta7s_schedule');
      if (stored) return JSON.parse(stored);
      // Seed with defaults
      localStorage.setItem('siesta7s_schedule', JSON.stringify(DEFAULT_SCHEDULE));
      return DEFAULT_SCHEDULE;
    }

    function saveScheduleData(data) {
      localStorage.setItem('siesta7s_schedule', JSON.stringify(data));
    }

    function getTeamPricingData() {
      const stored = localStorage.getItem('siesta7s_team_pricing');
      if (stored) return JSON.parse(stored);
      localStorage.setItem('siesta7s_team_pricing', JSON.stringify(DEFAULT_TEAM_PRICING));
      return DEFAULT_TEAM_PRICING;
    }

    function saveTeamPricingData(data) {
      localStorage.setItem('siesta7s_team_pricing', JSON.stringify(data));
    }

    function getFreeagentPricingData() {
      const stored = localStorage.getItem('siesta7s_freeagent_pricing');
      if (stored) return JSON.parse(stored);
      localStorage.setItem('siesta7s_freeagent_pricing', JSON.stringify(DEFAULT_FREEAGENT_PRICING));
      return DEFAULT_FREEAGENT_PRICING;
    }

    function saveFreeagentPricingData(data) {
      localStorage.setItem('siesta7s_freeagent_pricing', JSON.stringify(data));
    }

    function renderScheduleTable() {
      const tbody = document.getElementById('scheduleBody');
      const data = getScheduleData();
      
      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;padding:2rem;color:var(--gray-600);">
          No events scheduled. Click "Add Event" to create one.
        </td></tr>`;
        return;
      }
      
      tbody.innerHTML = data.map((event, index) => `
        <tr>
          <td>${event.day}</td>
          <td>${event.date}</td>
          <td><strong>${event.title}</strong></td>
          <td>${event.time}</td>
          <td>${event.location}</td>
          <td style="max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="${event.description}">${event.description}</td>
          <td>
            <button class="action-btn" onclick="editScheduleEvent(${index})" title="Edit">‚úèÔ∏è</button>
            <button class="action-btn delete" onclick="deleteScheduleEvent(${index})" title="Delete">üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
    }

    function openScheduleModal(index = -1) {
      document.getElementById('scheduleEditIndex').value = index;
      
      if (index >= 0) {
        const data = getScheduleData();
        const event = data[index];
        document.getElementById('scheduleModalTitle').textContent = 'Edit Event';
        document.getElementById('scheduleDay').value = event.day;
        document.getElementById('scheduleDate').value = event.date;
        document.getElementById('scheduleTitle').value = event.title;
        document.getElementById('scheduleTime').value = event.time;
        document.getElementById('scheduleLocation').value = event.location;
        document.getElementById('scheduleDescription').value = event.description;
      } else {
        document.getElementById('scheduleModalTitle').textContent = 'Add Event';
        document.getElementById('scheduleDay').value = 'Friday';
        document.getElementById('scheduleDate').value = '';
        document.getElementById('scheduleTitle').value = '';
        document.getElementById('scheduleTime').value = '';
        document.getElementById('scheduleLocation').value = '';
        document.getElementById('scheduleDescription').value = '';
      }
      
      document.getElementById('scheduleModal').classList.add('active');
      
      // Auto-resize textarea after modal is visible
      setTimeout(() => {
        autoResizeTextarea(document.getElementById('scheduleDescription'));
      }, 10);
    }

    // Auto-resize textarea to fit content
    function autoResizeTextarea(textarea) {
      if (!textarea) return;
      textarea.style.height = 'auto';
      textarea.style.height = Math.max(100, textarea.scrollHeight) + 'px';
    }

    // Set up auto-resize on input
    document.getElementById('scheduleDescription').addEventListener('input', function() {
      autoResizeTextarea(this);
    });

    function editScheduleEvent(index) {
      openScheduleModal(index);
    }

    function closeScheduleModal() {
      document.getElementById('scheduleModal').classList.remove('active');
    }

    function saveScheduleEvent() {
      const index = parseInt(document.getElementById('scheduleEditIndex').value);
      const event = {
        day: document.getElementById('scheduleDay').value,
        date: document.getElementById('scheduleDate').value,
        title: document.getElementById('scheduleTitle').value,
        time: document.getElementById('scheduleTime').value,
        location: document.getElementById('scheduleLocation').value,
        description: document.getElementById('scheduleDescription').value
      };
      
      if (!event.date || !event.title || !event.time || !event.location) {
        alert('Please fill in all required fields.');
        return;
      }
      
      const data = getScheduleData();
      
      if (index >= 0) {
        data[index] = event;
      } else {
        data.push(event);
      }
      
      saveScheduleData(data);
      renderScheduleTable();
      closeScheduleModal();
      alert(index >= 0 ? 'Event updated!' : 'Event added!');
    }

    function deleteScheduleEvent(index) {
      if (!confirm('Are you sure you want to delete this event?')) return;
      
      const data = getScheduleData();
      data.splice(index, 1);
      saveScheduleData(data);
      renderScheduleTable();
      alert('Event deleted!');
    }

    // =====================================================
    // PRICING MANAGEMENT
    // =====================================================

    function renderPricingTables() {
      renderTeamPricingTable();
      renderFreeagentPricingTable();
    }

    function renderTeamPricingTable() {
      const tbody = document.getElementById('teamPricingBody');
      const data = getTeamPricingData();
      
      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;padding:2rem;color:var(--gray-600);">
          No pricing tiers. Click "Add Tier" to create one.
        </td></tr>`;
        return;
      }
      
      tbody.innerHTML = data.map((tier, index) => `
        <tr>
          <td>${tier.name}</td>
          <td><strong>${tier.price}</strong></td>
          <td>${tier.deadline}</td>
          <td>
            <button class="action-btn" onclick="editPricingTier('team', ${index})" title="Edit">‚úèÔ∏è</button>
            <button class="action-btn delete" onclick="deletePricingTier('team', ${index})" title="Delete">üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
    }

    function renderFreeagentPricingTable() {
      const tbody = document.getElementById('freeagentPricingBody');
      const data = getFreeagentPricingData();
      
      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;padding:2rem;color:var(--gray-600);">
          No pricing tiers. Click "Add Tier" to create one.
        </td></tr>`;
        return;
      }
      
      tbody.innerHTML = data.map((tier, index) => `
        <tr>
          <td>${tier.name}</td>
          <td><strong>${tier.price}</strong></td>
          <td>${tier.deadline}</td>
          <td>
            <button class="action-btn" onclick="editPricingTier('freeagent', ${index})" title="Edit">‚úèÔ∏è</button>
            <button class="action-btn delete" onclick="deletePricingTier('freeagent', ${index})" title="Delete">üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
    }

    function openPricingModal(type, index = -1) {
      document.getElementById('pricingEditIndex').value = index;
      document.getElementById('pricingType').value = type;
      
      const typeLabel = type === 'team' ? 'Team' : 'Free Agent';
      
      if (index >= 0) {
        const data = type === 'team' ? getTeamPricingData() : getFreeagentPricingData();
        const tier = data[index];
        document.getElementById('pricingModalTitle').textContent = `Edit ${typeLabel} Tier`;
        document.getElementById('pricingTierName').value = tier.name;
        document.getElementById('pricingPrice').value = tier.price;
        document.getElementById('pricingDeadline').value = tier.deadline;
      } else {
        document.getElementById('pricingModalTitle').textContent = `Add ${typeLabel} Tier`;
        document.getElementById('pricingTierName').value = '';
        document.getElementById('pricingPrice').value = '';
        document.getElementById('pricingDeadline').value = '';
      }
      
      document.getElementById('pricingModal').classList.add('active');
    }

    function editPricingTier(type, index) {
      openPricingModal(type, index);
    }

    function closePricingModal() {
      document.getElementById('pricingModal').classList.remove('active');
    }

    function savePricingTier() {
      const index = parseInt(document.getElementById('pricingEditIndex').value);
      const type = document.getElementById('pricingType').value;
      
      const tier = {
        name: document.getElementById('pricingTierName').value,
        price: document.getElementById('pricingPrice').value,
        deadline: document.getElementById('pricingDeadline').value
      };
      
      if (!tier.name || !tier.price || !tier.deadline) {
        alert('Please fill in all required fields.');
        return;
      }
      
      let data;
      if (type === 'team') {
        data = getTeamPricingData();
        if (index >= 0) data[index] = tier; else data.push(tier);
        saveTeamPricingData(data);
        renderTeamPricingTable();
      } else {
        data = getFreeagentPricingData();
        if (index >= 0) data[index] = tier; else data.push(tier);
        saveFreeagentPricingData(data);
        renderFreeagentPricingTable();
      }
      
      closePricingModal();
      alert(index >= 0 ? 'Tier updated!' : 'Tier added!');
    }

    function deletePricingTier(type, index) {
      if (!confirm('Are you sure you want to delete this tier?')) return;
      
      let data;
      if (type === 'team') {
        data = getTeamPricingData();
        data.splice(index, 1);
        saveTeamPricingData(data);
        renderTeamPricingTable();
      } else {
        data = getFreeagentPricingData();
        data.splice(index, 1);
        saveFreeagentPricingData(data);
        renderFreeagentPricingTable();
      }
      
      alert('Tier deleted!');
    }

    // Initialize schedule and pricing on page load
    function initContentManagement() {
      renderScheduleTable();
      renderPricingTables();
    }

    // Call init when dashboard loads
    const originalShowDashboard = showDashboard;
    showDashboard = function() {
      originalShowDashboard();
      initContentManagement();
    };
  </script>
</body>
</html>
