<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Siesta 7s</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --navy: #1a365d;
      --sunset: #f6893a;
      --teal: #2d8b9e;
      --gold: #f4c542;
      --sand: #f5f0e6;
      --white: #ffffff;
      --gray-100: #f7fafc;
      --gray-200: #edf2f7;
      --gray-300: #e2e8f0;
      --gray-600: #718096;
      --gray-800: #2d3748;
      --success: #48bb78;
      --danger: #f56565;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--gray-100);
      min-height: 100vh;
    }

    /* Login Screen */
    .login-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--navy) 0%, var(--teal) 100%);
    }

    .login-card {
      background: var(--white);
      padding: 3rem;
      border-radius: 16px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      width: 100%;
      max-width: 400px;
      text-align: center;
    }

    .login-card h1 {
      color: var(--navy);
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .login-card p {
      color: var(--gray-600);
      margin-bottom: 2rem;
    }

    .login-input {
      width: 100%;
      padding: 1rem;
      border: 2px solid var(--gray-200);
      border-radius: 8px;
      font-size: 1rem;
      margin-bottom: 1rem;
      transition: border-color 0.2s;
    }

    .login-input:focus {
      outline: none;
      border-color: var(--teal);
    }

    .login-btn {
      width: 100%;
      padding: 1rem;
      background: var(--sunset);
      color: var(--white);
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(246, 137, 58, 0.4);
    }

    .login-error {
      color: var(--danger);
      font-size: 0.875rem;
      margin-top: 1rem;
      display: none;
    }

    /* Dashboard */
    .dashboard {
      display: none;
    }

    .dashboard.active {
      display: block;
    }

    .dashboard-header {
      background: var(--navy);
      color: var(--white);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .dashboard-header h1 {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .logout-btn {
      background: rgba(255,255,255,0.1);
      color: var(--white);
      border: 1px solid rgba(255,255,255,0.2);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: background 0.2s;
    }

    .logout-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    .dashboard-nav {
      background: var(--white);
      border-bottom: 1px solid var(--gray-200);
      padding: 0 2rem;
      display: flex;
      gap: 0;
    }

    .nav-tab {
      padding: 1rem 1.5rem;
      border: none;
      background: none;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray-600);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .nav-tab:hover {
      color: var(--navy);
    }

    .nav-tab.active {
      color: var(--teal);
      border-bottom-color: var(--teal);
    }

    .dashboard-content {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--white);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .stat-card h3 {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--gray-600);
      margin-bottom: 0.5rem;
    }

    .stat-card .value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--navy);
    }

    .stat-card .subtext {
      font-size: 0.875rem;
      color: var(--gray-600);
    }

    /* Data Table */
    .table-card {
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .table-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .table-header h2 {
      font-size: 1rem;
      color: var(--navy);
    }

    .refresh-btn {
      background: var(--gray-100);
      border: 1px solid var(--gray-300);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.875rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .refresh-btn:hover {
      background: var(--gray-200);
    }

    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--gray-200);
      font-size: 0.875rem;
    }

    th {
      background: var(--gray-50);
      font-weight: 600;
      color: var(--gray-600);
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.05em;
    }

    tr:hover {
      background: var(--gray-50);
    }

    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .status-paid {
      background: #c6f6d5;
      color: #22543d;
    }

    .status-pending {
      background: #feebc8;
      color: #744210;
    }

    .action-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.25rem;
      color: var(--gray-600);
      transition: color 0.2s;
    }

    .action-btn:hover {
      color: var(--teal);
    }

    .action-btn.delete:hover {
      color: var(--danger);
    }

    /* Loading State */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      color: var(--gray-600);
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--gray-300);
      border-top-color: var(--teal);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 0.5rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Tab panels */
    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--gray-600);
    }

    .empty-state svg {
      width: 48px;
      height: 48px;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--white);
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-size: 1.125rem;
      color: var(--navy);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray-600);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray-800);
      margin-bottom: 0.5rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--gray-300);
      border-radius: 6px;
      font-size: 0.875rem;
    }

    .modal-footer {
      padding: 1.5rem;
      border-top: 1px solid var(--gray-200);
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-secondary {
      background: var(--gray-100);
      border: 1px solid var(--gray-300);
      color: var(--gray-800);
    }

    .btn-primary {
      background: var(--teal);
      border: none;
      color: var(--white);
    }

    .btn-primary:hover {
      background: #247a8a;
    }

    .btn-danger {
      background: var(--danger);
      border: none;
      color: var(--white);
    }

    /* Revenue highlight */
    .revenue {
      color: var(--success);
    }

    @media (max-width: 768px) {
      .dashboard-nav {
        overflow-x: auto;
        padding: 0 1rem;
      }

      .dashboard-content {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>

  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <div class="login-card">
      <h1>üèâ Siesta 7s Admin</h1>
      <p>Enter password to access dashboard</p>
      <form id="loginForm">
        <input type="password" class="login-input" id="passwordInput" placeholder="Password" autocomplete="off">
        <button type="submit" class="login-btn">Login</button>
        <p class="login-error" id="loginError">Incorrect password. Try again.</p>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">
    <header class="dashboard-header">
      <h1>üèâ Siesta 7s ‚Äî Event Dashboard</h1>
      <button class="logout-btn" id="logoutBtn">Logout</button>
    </header>

    <nav class="dashboard-nav">
      <button class="nav-tab active" data-tab="overview">Overview</button>
      <button class="nav-tab" data-tab="teams">Teams</button>
      <button class="nav-tab" data-tab="freeagents">Free Agents</button>
      <button class="nav-tab" data-tab="vendors">Vendors</button>
      <button class="nav-tab" data-tab="sponsors">Sponsors</button>
    </nav>

    <main class="dashboard-content">
      <!-- Overview Tab -->
      <div class="tab-panel active" id="overview">
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Teams Registered</h3>
            <div class="value" id="teamCount">-</div>
          </div>
          <div class="stat-card">
            <h3>Free Agents</h3>
            <div class="value" id="freeAgentCount">-</div>
          </div>
          <div class="stat-card">
            <h3>Vendors</h3>
            <div class="value" id="vendorCount">-</div>
          </div>
          <div class="stat-card">
            <h3>Sponsors</h3>
            <div class="value" id="sponsorCount">-</div>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <h3>Total Revenue (Expected)</h3>
            <div class="value revenue" id="totalRevenue">$0</div>
            <div class="subtext">Based on registration fees</div>
          </div>
          <div class="stat-card">
            <h3>Days Until Event</h3>
            <div class="value" id="daysUntil">-</div>
            <div class="subtext">May 16, 2025</div>
          </div>
        </div>
      </div>

      <!-- Teams Tab -->
      <div class="tab-panel" id="teams">
        <div class="table-card">
          <div class="table-header">
            <h2>Team Registrations</h2>
            <button class="refresh-btn" onclick="loadData('Teams')">
              <span>‚Üª</span> Refresh
            </button>
          </div>
          <div class="table-container">
            <div class="loading" id="teamsLoading">
              <div class="spinner"></div>
              Loading...
            </div>
            <table id="teamsTable" style="display:none;">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Team Name</th>
                  <th>Captain</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Division</th>
                  <th>Amount</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="teamsBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Free Agents Tab -->
      <div class="tab-panel" id="freeagents">
        <div class="table-card">
          <div class="table-header">
            <h2>Free Agent Registrations</h2>
            <button class="refresh-btn" onclick="loadData('Free Agents')">
              <span>‚Üª</span> Refresh
            </button>
          </div>
          <div class="table-container">
            <div class="loading" id="freeagentsLoading">
              <div class="spinner"></div>
              Loading...
            </div>
            <table id="freeagentsTable" style="display:none;">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Experience</th>
                  <th>Amount</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="freeagentsBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Vendors Tab -->
      <div class="tab-panel" id="vendors">
        <div class="table-card">
          <div class="table-header">
            <h2>Vendor Applications</h2>
            <button class="refresh-btn" onclick="loadData('Vendors')">
              <span>‚Üª</span> Refresh
            </button>
          </div>
          <div class="table-container">
            <div class="loading" id="vendorsLoading">
              <div class="spinner"></div>
              Loading...
            </div>
            <table id="vendorsTable" style="display:none;">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Business</th>
                  <th>Contact</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Type</th>
                  <th>Amount</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="vendorsBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Sponsors Tab -->
      <div class="tab-panel" id="sponsors">
        <div class="table-card">
          <div class="table-header">
            <h2>Sponsor Inquiries</h2>
            <button class="refresh-btn" onclick="loadData('Sponsors')">
              <span>‚Üª</span> Refresh
            </button>
          </div>
          <div class="table-container">
            <div class="loading" id="sponsorsLoading">
              <div class="spinner"></div>
              Loading...
            </div>
            <table id="sponsorsTable" style="display:none;">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Company</th>
                  <th>Contact</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Level</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="sponsorsBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Edit Modal -->
  <div class="modal-overlay" id="editModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Edit Entry</h3>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="editModalBody">
        <!-- Dynamic form fields -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveEdit()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Confirm Delete</h3>
        <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this entry? This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
        <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const CONFIG = {
      password: 'Surge2010!',
      scriptUrl: 'https://script.google.com/macros/s/AKfycbyndwQKFl7FMY9PjM525VMR8ImmhMm5ShelQtGU1wcVnZtxCyERMfxQohDzeo8wdgmkpA/exec',
      eventDate: new Date('2025-05-16T09:00:00-04:00')
    };

    // State
    let allData = {
      'Teams': [],
      'Free Agents': [],
      'Vendors': [],
      'Sponsors': []
    };
    let currentEdit = null;
    let currentDelete = null;

    // DOM Elements
    const loginScreen = document.getElementById('loginScreen');
    const dashboard = document.getElementById('dashboard');
    const loginForm = document.getElementById('loginForm');
    const loginError = document.getElementById('loginError');
    const passwordInput = document.getElementById('passwordInput');

    // Check if already logged in
    if (sessionStorage.getItem('siesta7s_admin') === 'true') {
      showDashboard();
    }

    // Login handling
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (passwordInput.value === CONFIG.password) {
        sessionStorage.setItem('siesta7s_admin', 'true');
        showDashboard();
      } else {
        loginError.style.display = 'block';
        passwordInput.value = '';
      }
    });

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', () => {
      sessionStorage.removeItem('siesta7s_admin');
      location.reload();
    });

    // Tab navigation
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.dataset.tab;
        
        // Update active tab
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update active panel
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        
        // Load data for this tab
        if (tabId !== 'overview') {
          const formType = tabId === 'freeagents' ? 'Free Agents' : 
                          tabId.charAt(0).toUpperCase() + tabId.slice(1);
          loadData(formType);
        }
      });
    });

    function showDashboard() {
      loginScreen.style.display = 'none';
      dashboard.classList.add('active');
      loadAllData();
    }

    async function loadAllData() {
      updateDaysUntil();
      
      // Load all data types
      await Promise.all([
        loadData('Teams'),
        loadData('Free Agents'),
        loadData('Vendors'),
        loadData('Sponsors')
      ]);
      
      updateOverviewStats();
    }

    async function loadData(formType) {
      const tabId = formType === 'Free Agents' ? 'freeagents' : formType.toLowerCase();
      const loading = document.getElementById(`${tabId}Loading`);
      const table = document.getElementById(`${tabId}Table`);
      const tbody = document.getElementById(`${tabId}Body`);
      
      if (loading) loading.style.display = 'flex';
      if (table) table.style.display = 'none';
      
      try {
        const response = await fetch(`${CONFIG.scriptUrl}?action=getData&formType=${encodeURIComponent(formType)}`);
        const result = await response.json();
        
        if (result.data) {
          allData[formType] = result.data;
          renderTable(formType, result.data);
        }
      } catch (error) {
        console.error(`Error loading ${formType}:`, error);
        if (tbody) {
          tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;padding:2rem;color:var(--gray-600);">
            Error loading data. Make sure Google Sheets is configured correctly.
          </td></tr>`;
        }
      }
      
      if (loading) loading.style.display = 'none';
      if (table) table.style.display = 'table';
    }

    function renderTable(formType, data) {
      const tabId = formType === 'Free Agents' ? 'freeagents' : formType.toLowerCase();
      const tbody = document.getElementById(`${tabId}Body`);
      
      if (!tbody) return;
      
      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;padding:2rem;color:var(--gray-600);">
          No registrations yet.
        </td></tr>`;
        return;
      }
      
      tbody.innerHTML = data.map((row, index) => {
        const date = row[0] ? new Date(row[0]).toLocaleDateString() : '-';
        return `
          <tr>
            <td>${date}</td>
            ${row.slice(1).map(cell => `<td>${cell || '-'}</td>`).join('')}
            <td>
              <button class="action-btn" onclick="editRow('${formType}', ${index})" title="Edit">‚úèÔ∏è</button>
              <button class="action-btn delete" onclick="deleteRow('${formType}', ${index})" title="Delete">üóëÔ∏è</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function updateOverviewStats() {
      document.getElementById('teamCount').textContent = allData['Teams'].length;
      document.getElementById('freeAgentCount').textContent = allData['Free Agents'].length;
      document.getElementById('vendorCount').textContent = allData['Vendors'].length;
      document.getElementById('sponsorCount').textContent = allData['Sponsors'].length;
      
      // Calculate total revenue (simplified - you may want to sum actual amounts)
      let revenue = 0;
      allData['Teams'].forEach(row => {
        const amount = parseFloat(row[row.length - 1]) || 0;
        revenue += amount;
      });
      allData['Free Agents'].forEach(row => {
        const amount = parseFloat(row[row.length - 1]) || 0;
        revenue += amount;
      });
      allData['Vendors'].forEach(row => {
        const amount = parseFloat(row[row.length - 1]) || 0;
        revenue += amount;
      });
      
      document.getElementById('totalRevenue').textContent = `$${revenue.toLocaleString()}`;
    }

    function updateDaysUntil() {
      const now = new Date();
      const diff = CONFIG.eventDate - now;
      const days = Math.max(0, Math.floor(diff / (1000 * 60 * 60 * 24)));
      document.getElementById('daysUntil').textContent = days;
    }

    function editRow(formType, index) {
      currentEdit = { formType, index };
      const row = allData[formType][index];
      
      const modalBody = document.getElementById('editModalBody');
      const headers = getHeaders(formType);
      
      modalBody.innerHTML = headers.map((header, i) => `
        <div class="form-group">
          <label>${header}</label>
          <input type="text" id="editField${i}" value="${row[i] || ''}">
        </div>
      `).join('');
      
      document.getElementById('editModal').classList.add('active');
    }

    function getHeaders(formType) {
      switch (formType) {
        case 'Teams':
          return ['Date', 'Team Name', 'Captain', 'Email', 'Phone', 'Division', 'Tier', 'Amount'];
        case 'Free Agents':
          return ['Date', 'Name', 'Email', 'Phone', 'Experience', 'Tier', 'Amount'];
        case 'Vendors':
          return ['Date', 'Business', 'Contact', 'Email', 'Phone', 'Type', 'Tier', 'Amount'];
        case 'Sponsors':
          return ['Date', 'Company', 'Contact', 'Email', 'Phone', 'Level', 'Message'];
        default:
          return [];
      }
    }

    async function saveEdit() {
      if (!currentEdit) return;
      
      const { formType, index } = currentEdit;
      const headers = getHeaders(formType);
      const newData = headers.map((_, i) => document.getElementById(`editField${i}`).value);
      
      try {
        const response = await fetch(CONFIG.scriptUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'updateRow',
            formType,
            rowIndex: index + 2, // +2 because sheets are 1-indexed and have header row
            data: newData
          })
        });
        
        // Update local data
        allData[formType][index] = newData;
        renderTable(formType, allData[formType]);
        updateOverviewStats();
        closeModal();
        
        alert('Changes saved successfully!');
      } catch (error) {
        console.error('Error saving:', error);
        alert('Error saving changes. Please try again.');
      }
    }

    function closeModal() {
      document.getElementById('editModal').classList.remove('active');
      currentEdit = null;
    }

    function deleteRow(formType, index) {
      currentDelete = { formType, index };
      document.getElementById('deleteModal').classList.add('active');
    }

    async function confirmDelete() {
      if (!currentDelete) return;
      
      const { formType, index } = currentDelete;
      
      try {
        const response = await fetch(CONFIG.scriptUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'deleteRow',
            formType,
            rowIndex: index + 2 // +2 because sheets are 1-indexed and have header row
          })
        });
        
        // Update local data
        allData[formType].splice(index, 1);
        renderTable(formType, allData[formType]);
        updateOverviewStats();
        closeDeleteModal();
        
        alert('Entry deleted successfully!');
      } catch (error) {
        console.error('Error deleting:', error);
        alert('Error deleting entry. Please try again.');
      }
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('active');
      currentDelete = null;
    }
  </script>
</body>
</html>
